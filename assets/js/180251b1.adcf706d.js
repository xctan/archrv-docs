"use strict";(self.webpackChunkriscv_package_guide=self.webpackChunkriscv_package_guide||[]).push([[321],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=p(n),d=l,k=m["".concat(s,".").concat(d)]||m[d]||u[d]||r;return n?a.createElement(k,o(o({ref:t},c),{},{components:n})):a.createElement(k,o({ref:t},c))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8098:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return u}});var a=n(7462),l=n(3366),r=(n(7294),n(3905)),o=["components"],i={},s="\u5947\u5947\u602a\u602a\u7684\u9519\u8bef\u4eec",p={unversionedId:"record/collection",id:"record/collection",title:"\u5947\u5947\u602a\u602a\u7684\u9519\u8bef\u4eec",description:"\u963f\u91cc\u4e91\u4e0a\u9047\u5230 sigsegv",source:"@site/docs/record/collection.md",sourceDirName:"record",slug:"/record/collection",permalink:"/docs/record/collection",draft:!1,editUrl:"https://github.com/Avimitin/archrv-docs/docs/record/collection.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u5982\u4f55\u7ed9 Arch \u62a5 BUG",permalink:"/docs/guide/bug-report"},next:{title:"lto \u76f8\u5173\u7684\u95ee\u9898",permalink:"/docs/record/lto"}},c={},u=[{value:"\u963f\u91cc\u4e91\u4e0a\u9047\u5230 sigsegv",id:"\u963f\u91cc\u4e91\u4e0a\u9047\u5230-sigsegv",level:2},{value:"Executable &quot;wasm-ld&quot; doesn&#39;t exist! (STUCK)",id:"executable-wasm-ld-doesnt-exist-stuck",level:2},{value:"pthread related issue",id:"pthread-related-issue",level:2},{value:"gcc atomic",id:"gcc-atomic",level:2},{value:"-fno-common",id:"-fno-common",level:2},{value:"-Wno-format",id:"-wno-format",level:2},{value:"-Werror=format-security",id:"-werrorformat-security",level:2},{value:"\u5982\u4f55\u5feb\u6377\u751f\u6210 sha256sums",id:"\u5982\u4f55\u5feb\u6377\u751f\u6210-sha256sums",level:2},{value:"\u4fee\u4ee3\u7801\u4f18\u5148\u8fd8\u662f\u6539\u7f16\u8bd1 flag \u4f18\u5148\uff1f",id:"\u4fee\u4ee3\u7801\u4f18\u5148\u8fd8\u662f\u6539\u7f16\u8bd1-flag-\u4f18\u5148",level:2},{value:"noqemu",id:"noqemu",level:2},{value:"Rust",id:"rust",level:2},{value:"SSE Related issue",id:"sse-related-issue",level:2},{value:"Go",id:"go",level:2},{value:"Patch <code>go dep</code>",id:"patch-go-dep",level:3},{value:"\u7ed9 go \u5305\u7684\u4f9d\u8d56\uff08\u7684\u4f9d\u8d56\uff09\u6253patch\u7684\u6b63\u786e\u65b9\u5f0f",id:"\u7ed9-go-\u5305\u7684\u4f9d\u8d56\u7684\u4f9d\u8d56\u6253patch\u7684\u6b63\u786e\u65b9\u5f0f",level:3},{value:"\u7f16\u8bd1 golang \u5305\u7684\u65f6\u5019\u7ecf\u5e38\u5361\u6b7b",id:"\u7f16\u8bd1-golang-\u5305\u7684\u65f6\u5019\u7ecf\u5e38\u5361\u6b7b",level:3},{value:"bad pointer",id:"bad-pointer",level:3},{value:"\u7248\u672c\u53f7",id:"\u7248\u672c\u53f7",level:2},{value:"\u5faa\u73af\u4f9d\u8d56",id:"\u5faa\u73af\u4f9d\u8d56",level:2},{value:"Intel related",id:"intel-related",level:2},{value:"Qmake",id:"qmake",level:2},{value:"XX is not available for the &#39;riscv64&#39; architecture",id:"xx-is-not-available-for-the-riscv64-architecture",level:2},{value:"msse",id:"msse",level:2},{value:"Unknown public key....",id:"unknown-public-key",level:2},{value:"Electron",id:"electron",level:2},{value:"node-sass",id:"node-sass",level:2},{value:"\u5173\u4e8e upstream",id:"\u5173\u4e8e-upstream",level:2},{value:"Python 2to3",id:"python-2to3",level:2},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:2},{value:"\u8bbf\u95ee\u4e00\u4e9b\u4f1a\u5728\u7f16\u8bd1\u671f\u88ab\u5220\u9664\u7684\u6587\u4ef6",id:"\u8bbf\u95ee\u4e00\u4e9b\u4f1a\u5728\u7f16\u8bd1\u671f\u88ab\u5220\u9664\u7684\u6587\u4ef6",level:2},{value:"gcc nostdlib",id:"gcc-nostdlib",level:2},{value:"glibc optimization",id:"glibc-optimization",level:2},{value:"patch hunk offset",id:"patch-hunk-offset",level:2},{value:"unguarded-availability-new",id:"unguarded-availability-new",level:2},{value:"tarball URL \u53d8\u4e86\u8be5\u600e\u4e48\u529e",id:"tarball-url-\u53d8\u4e86\u8be5\u600e\u4e48\u529e",level:2},{value:"\u5728 QEMU \u5185\u6784\u5efa\u5931\u8d25\u4f46\u5728\u677f\u5b50\u4e0a\u6784\u5efa\u6210\u529f\u600e\u4e48\u5904\u7406",id:"\u5728-qemu-\u5185\u6784\u5efa\u5931\u8d25\u4f46\u5728\u677f\u5b50\u4e0a\u6784\u5efa\u6210\u529f\u600e\u4e48\u5904\u7406",level:2},{value:"invalid or corrupted package (pgp signature)",id:"invalid-or-corrupted-package-pgp-signature",level:2},{value:"\u78c1\u76d8\u5360\u7528\u6ee1\u4e86",id:"\u78c1\u76d8\u5360\u7528\u6ee1\u4e86",level:2},{value:"\u5927\u91cf\u4f9d\u8d56\u7f3a\u5931",id:"\u5927\u91cf\u4f9d\u8d56\u7f3a\u5931",level:2},{value:"config.guess",id:"configguess",level:2},{value:"nodejs \u7684\u67d0\u4e9b\u5305\u51fa\u73b0\u602a\u5f02\u7684\u9519\u8bef",id:"nodejs-\u7684\u67d0\u4e9b\u5305\u51fa\u73b0\u602a\u5f02\u7684\u9519\u8bef",level:2}],m={toc:u};function d(e){var t=e.components,n=(0,l.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u5947\u5947\u602a\u602a\u7684\u9519\u8bef\u4eec"},"\u5947\u5947\u602a\u602a\u7684\u9519\u8bef\u4eec"),(0,r.kt)("h2",{id:"\u963f\u91cc\u4e91\u4e0a\u9047\u5230-sigsegv"},"\u963f\u91cc\u4e91\u4e0a\u9047\u5230 sigsegv"),(0,r.kt)("p",null,"\u5982\u679c\u5728\u963f\u91cc\u4e91\u4e0a\u9047\u5230\u5947\u5947\u602a\u602a\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"segmentation fault"),"\uff0c\n\u9996\u5148\u786e\u8ba4 rustc \u7684",(0,r.kt)("a",{parentName:"p",href:"/docs/record/rust-related#%E7%BC%96%E8%AF%91%E6%97%B6%E9%81%87%E5%88%B0%E4%BA%86%E5%A5%87%E6%80%AA%E7%9A%84-sigsegv"},"\u4f18\u5316"),"\n\u6709\u65e0\u95ee\u9898\uff0c\u5982\u679c\u67e5\u4e0d\u51fa\u6765\u95ee\u9898\u7684\u8bdd\uff0c\n\u9ed8\u8ba4\u8ba4\u4e3a\u963f\u91cc\u4e91\u7684\u865a\u62df\u5316\u6709\u95ee\u9898\u3002"),(0,r.kt)("h2",{id:"executable-wasm-ld-doesnt-exist-stuck"},'Executable "wasm-ld" doesn\'t exist! (STUCK)'),(0,r.kt)("p",null,"\u8981\u5b89\u88c5 lld\uff0cwasm-ld \u53ea\u5728 lld \u91cc\u9762\u6709\u3002"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"Firefox \u7684\u8bdd\uff0c\u5f15\u5165 lld \u4f1a\u5e26\u6765\u53e6\u5916\u7684\u95ee\u9898\u3002lld \u662f\u9700\u8981\u9ed8\u8ba4\u5173\u95ed\u7684\uff0c\n\u95ee\u9898\u6765\u6e90\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"-mno-relax")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"-mrelax")," \u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u67e5\u770b\u8fd9\u4e2a PR \u4e86\u89e3\u8be6\u60c5 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/felixonmars/archriscv-packages/pull/139"},"https://github.com/felixonmars/archriscv-packages/pull/139")),(0,r.kt)("h2",{id:"pthread-related-issue"},"pthread related issue"),(0,r.kt)("p",null,"\u6807\u51c6\u7b54\u6848\uff1a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/felixonmars/archriscv-packages/pull/1035"},"PR #1035")),(0,r.kt)("h2",{id:"gcc-atomic"},"gcc atomic"),(0,r.kt)("p",null,"gcc \u7684 1B 2B atomic \u5b9e\u73b0\u5728 riscv64 \u6709\u95ee\u9898\u3002gcc \u7684 1B 2B atomic \u5b9e\u73b0\u9700\u8981\u8dd1\u5230 libatomic\uff0c\n\u4e8e\u662f\u6ca1\u6cd5\u5728\u7f16\u8bd1\u671f\u5224\u65ad\u662f\u5426\u65e0\u9501"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"ref: ",(0,r.kt)("a",{parentName:"p",href:"https://code.videolan.org/videolan/vlc/-/issues/20683"},"https://code.videolan.org/videolan/vlc/-/issues/20683")),(0,r.kt)("p",{parentName:"blockquote"},"The GCC docs make it clear that -pthread is the correct way to use the pthread\nlibrary on POSIX systems.  Not only does it add extra necessary linker options\nfor some targets, but it also adds some extra necessary preprocessor options\nfor many targets.  There is also the issue that the library is called -lpthread\non some systems, and -lpthreads on others.  The -pthread option handles this\ncorrectly."),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"It is a known problem that the RISC-V gcc atomic support needs more work.\nRISC-V only supports 4 and 8 byte atomic operations in hardware.  1 and 2 byte\noperations are implemented using instruction sequences with locks, and this is\ncurrently done via a call into libatomic."),"  However, mixing lock free and\nnon-locking atomic sequences can potentially cause run-time failures.  We need\nto instead emit instruction sequences using 4 and/or 8 byte atomic instructions\nwithout locks.  This is on the list of things that need to be fixed, but there\nare a lot of things that need to be fixed and we haven't gotten around to\nfixing this one yet.  This definitively needs to be fixed before gcc 9, and\nhopefully much sooner than that."),(0,r.kt)("p",{parentName:"blockquote"},"While the RISC-V gcc port does need to be fixed, it is still true that you\nshould be using -pthread instead of -lpthread.")),(0,r.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u4e00\u4e2a\u5f88\u8be1\u5f02\u7684\u4e8b\u60c5\uff1a\u5c31\u662f\u5728 gcc \u91cc\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"std::atomic<bool>::is_always_lock_free"),"\n\u662f false\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"std::atomic<int>::is_always_lock_free")," \u662f true\u3002\u4f46\u662f\u5982\u679c\u4f60\u5728\u8fd0\u884c\u7684\u65f6\u5019\n\u6574\u4e00\u4e2a bool b; ",(0,r.kt)("inlineCode",{parentName:"p"},"std::atomic_is_lock_free(&b)"),"\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u662f true\uff0c\u800c\u4e14\u662f\uff0c\u4e0d\u7ba1\u600e\u4e48\u8bd5\uff0c\n\u5728\u54ea\u8bd5\uff0c\u5b83\u90fd\u662f true\u3002"),(0,r.kt)("p",null,"\u5728 gcc \u91cc\u9762\u5927\u6982 ATOMIC_BOOL_LOCK_FREE \u662f 1\uff081 for the built-in atomic types\nthat are sometimes lock-free)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"ref: ",(0,r.kt)("a",{parentName:"p",href:"https://www.mail-archive.com/gcc-bugs@gcc.gnu.org/msg664254.html"},"https://www.mail-archive.com/gcc-bugs@gcc.gnu.org/msg664254.html")),(0,r.kt)("p",{parentName:"blockquote"},"tldr: \u53ea\u80fd\u7b49 gcc \u7684\u4eba\u5b9e\u73b0 sub-word lock-free atomic \u4e86"),(0,r.kt)("p",{parentName:"blockquote"},"All atomic types except for std::atomic_flag may be implemented using mutexes\nor other locking operations, rather than using the lock-free atomic CPU\ninstructions. Atomic types are also allowed to be sometimes lock-free, e.g. if\nonly aligned memory accesses are naturally atomic on a given architecture,\nmisaligned objects of the same type have to use locks."),(0,r.kt)("p",{parentName:"blockquote"},"Thanks for the detailed writeup!"),(0,r.kt)("p",{parentName:"blockquote"},'Your analysis is basically correct, but I would add that ICC\'s behavior here is\nunsound (it only appears to "implement[] this behavior correctly" in simple cases)\nwhereas the GCC/Clang behavior is sound but surprising. For GCC, ICC, and Clang, ',(0,r.kt)("inlineCode",{parentName:"p"},"identity <fp>"),"\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"identity<float>")," are the same type. Therefore it's not possible for ",(0,r.kt)("inlineCode",{parentName:"p"},"identity <fp>::type"),"\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"identity<float>::type")," to have different alignments, because they're\nthe same type. So, for an example such as this:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"typedef float fp  __attribute__((aligned(16)));\nstd::cout << alignof(typename identity<fp>::type) << std::endl;\nstd::cout << alignof(typename identity<float>::type) << std::endl;\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"under GCC and Clang, both lines print out 4, whereas under ICC, they either both\nprint out 4 or both print out 16 depending on which one happens to appear first\nin the program (and in general you can encounter ODR violations when using ICC despite\nthere being nothing wrong at the source level).")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Fundamentally, the 'aligned' attribute is a GCC extension, so the GCC folks get\nto define how it works. And they chose that instead of it resulting in a different\ntype that's ",(0,r.kt)("em",{parentName:"p"},"almost")," like the original type (for example, treating it as a type\nqualifier), it results in the same type, but that in some contexts that same type\nbehaves differently. That's a semantic disaster, but it's what we live with. And\nin particular, the only way for template instantiation to be sound in the presence\nof this semantic disaster is for it to ignore all such attributes on template type\narguments.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4e00\u4e9b\u53c2\u8003\u89e3\u51b3\u65b9\u6848\uff1a"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/savoirfairelinux/opendht/pull/598/files"},"https://github.com/savoirfairelinux/opendht/pull/598/files")),(0,r.kt)("li",{parentName:"ul"},"\u5982\u4f55\u68c0\u67e5 libatomic: ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/danvratil/qcoro/pull/52/commits/312f2fca861b4c623481da58241a1139e013ef83"},"https://github.com/danvratil/qcoro/pull/52/commits/312f2fca861b4c623481da58241a1139e013ef83")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u7ed9\u4e0a\u6e38\u770b\u7684\u89e3\u91ca\u8303\u4f8b\uff1a"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/savoirfairelinux/opendht/pull/598#issuecomment-1086945416"},"https://github.com/savoirfairelinux/opendht/pull/598#issuecomment-1086945416")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/telegramdesktop/tdesktop/pull/24275"},"https://github.com/telegramdesktop/tdesktop/pull/24275")),(0,r.kt)("li",{parentName:"ul"},'\u8bc1\u660e\u5efa\u7acb"\u4f60\u663e\u5f0f\u7528\u4e86atomic"\u548c"\u4f60\u5f97\u68c0\u67e5libatomic"\u76f4\u63a5\u5173\u7cfb\u7684\u53c2\u8003\u6587\u6863:\n',(0,r.kt)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_concurrency.html"},"https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_concurrency.html"))))),(0,r.kt)("h2",{id:"-fno-common"},"-fno-common"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Q"),": -fno-common \u53d6\u4ee3\u4e86 -fcommon, \u8fd9\u79cd\u60c5\u51b5\u4f18\u5148 -fno-common \u8fd8\u662f patch source\uff1f"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"A"),": \u4f18\u5148 patch source\u3002\n\u4e00\u822c\u6765\u8bf4\u80fd\u4e0d\u52a8flags\u5c3d\u91cf\u4e0d\u52a8\u3002\n\u5c11\u6570\u4f8b\u5916\u662f\uff0c\u6bd4\u5982\uff0c\u8fd9\u4e2a\u9879\u76ee\u6b7b\u4e86\u5341\u5e74\u4e86\uff0c\u8fde\u4e2arepo\u90fd\u627e\u4e0d\u5230\u3002"),(0,r.kt)("p",null,"\u4e0d\u8fc7\u5982\u679c\u662f -fcommon \u8fd9\u79cd\uff0c\u6bd4\u8f83\u63a8\u8350\u7684\u662f\u5148\u63d0\u7ed9\u4e0a\u6e38\uff0c\u54b1\u4eecpatch\u7740\u6253\u3002\n\u8fd9\u6837\u4e0b\u6b21\u4e0a\u6e38\u53d1\u7248\u672carch\u90a3\u8fb9\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u83ab\u540d\u5176\u5999\u597d\u4e86\uff0c\u4ed6\u4eec\u4e0d\u7528\u505a\u4ec0\u4e48\uff0c\u6211\u4eec\u4e5f\u53ea\u7528\u5220\u6389patch\u3002"),(0,r.kt)("h2",{id:"-wno-format"},"-Wno-format"),(0,r.kt)("p",null,"\u5982\u679c\u9047\u5230\n",(0,r.kt)("inlineCode",{parentName:"p"},"cc1: error: -Wformat-security ignored without -Wformat [-Werror=format-security]"),"\uff0c\n\u8fd9\u4e2a\u9519\u8bef\u662f\u56e0\u4e3a\u4ee3\u7801\u88ab\u7f16\u8bd1\u7684\u65f6\u5019\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"CFLAG")," \u9009\u9879\u591a\u4e86\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"-Wno-format"),"\uff0c\u8fd9\u4e2a\u9009\u9879\u4f1a\u5173\u95ed\n",(0,r.kt)("inlineCode",{parentName:"p"},"-Wformat"),"\uff0c\u4f46 ",(0,r.kt)("inlineCode",{parentName:"p"},"-Werror=format-security")," \u4ecd\u7136\u4fdd\u7559\u7740\u3002"),(0,r.kt)("p",null,"\u89e3\u51b3\u65b9\u6848\u9996\u5148\u662f\u8ba9\u4e0a\u6e38\u4fee\uff0c\u7136\u540e\u5f15\u7528 patch\uff0c\u53c2\u8003\u4e0a\u9762\u90a3\u4e00\u7ae0\u8282\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u662f\u4e00\u4e07\u5e74\u4e0d\u66f4\u65b0\u7684\u4ee3\u7801\u4ed3\u5e93\uff0c\u90a3\u53ef\u4ee5\u914c\u60c5\u4f7f\u7528\n",(0,r.kt)("inlineCode",{parentName:"p"},"${CFLAG#-Werror=format-security}")," \u6216\u8005 ",(0,r.kt)("inlineCode",{parentName:"p"},"sed -i 's/ -Werror=format-security // Makefile"),"\n\u628a\u8fd9\u4e2a\u9009\u9879\u5220\u9664\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\u5c3d\u91cf\u73b0\u5728\u7fa4\u91cc\u8ba8\u8bba\uff0c\u95ee\u95ee\u524d\u8f88\u7684\u610f\u89c1\u3002"),(0,r.kt)("h2",{id:"-werrorformat-security"},"-Werror=format-security"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text",metastring:"title=manpage",title:"manpage"},'-Wformat-security\n   If -Wformat is specified, also warn about uses of format functions that represent possible security problems.  At present, this warns about calls to "printf" and "scanf" functions where the\n   format string is not a string literal and there are no format arguments, as in "printf (foo);".  This may be a security hole if the format string came from untrusted input and contains %n.\n   (This is currently a subset of what -Wformat-nonliteral warns about, but in future warnings may be added to -Wformat-security that are not included in -Wformat-nonliteral.)\n')),(0,r.kt)("p",null,"\u9996\u5148\uff0c\u4f18\u5148\u7ed9\u4e0a\u6e38\u53d1\u8865\u4e01\u3002\u4ece manpage \u4e5f\u53ef\u4ee5\u770b\u7684\u51fa\u6765\uff0c\u53ea\u9700\u8981\u628a ",(0,r.kt)("inlineCode",{parentName:"p"},"printf")," \u6539\u6210 ",(0,r.kt)("inlineCode",{parentName:"p"},'printf("%s")')," \u7684\u5f62\u5f0f\u5373\u53ef\u3002"),(0,r.kt)("p",null,"\u9664\u975e\u4e0a\u6e38\u5341\u591a\u5e74\u6ca1\u52a8\u9759\uff0c\u624d\u53ef\u4ee5\u9009\u62e9\u628a\u8fd9\u4e2a\u9009\u9879\u5220\u6389\u3002\n\u53ef\u4ee5\u7528\uff1a ",(0,r.kt)("inlineCode",{parentName:"p"},"CFLAGS=${CFLAGS/-Werror=format-security/}")),(0,r.kt)("p",null,"\u5982\u679c\u4e0a\u6e38\u5f88\u96be\u6c9f\u901a\uff0c\u6216\u8005\u4e0a\u6e38\u4ee3\u7801\u4e0d\u592a\u597d\u4fee\uff0c\u4f18\u5148\u81ea\u5df1\u4fee\uff0c\u7136\u540e\u548c\u7fa4\u91cc\u7684\u524d\u8f88\u5546\u91cf\u4e00\u4e0b\u89e3\u51b3\u65b9\u6848\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Reference:\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/felixonmars/archriscv-packages/pull/559"},"https://github.com/felixonmars/archriscv-packages/pull/559"))),(0,r.kt)("h2",{id:"\u5982\u4f55\u5feb\u6377\u751f\u6210-sha256sums"},"\u5982\u4f55\u5feb\u6377\u751f\u6210 sha256sums"),(0,r.kt)("p",null,"\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://archlinux.org/packages/community/x86_64/pacman-contrib/"},"updpkgsums")),(0,r.kt)("h2",{id:"\u4fee\u4ee3\u7801\u4f18\u5148\u8fd8\u662f\u6539\u7f16\u8bd1-flag-\u4f18\u5148"},"\u4fee\u4ee3\u7801\u4f18\u5148\u8fd8\u662f\u6539\u7f16\u8bd1 flag \u4f18\u5148\uff1f"),(0,r.kt)("p",null,"\u4f18\u5148\u4fee\u4ee3\u7801\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u53c2\u8003\uff1a\n",(0,r.kt)("a",{parentName:"p",href:"https://build.opensuse.org/package/view_file/devel:ARM:Factory:Contrib:ILP32/presage/presage-0.9.1-gcc11.patch?expand=0"},"https://build.opensuse.org/package/view_file/devel:ARM:Factory:Contrib:ILP32/presage/presage-0.9.1-gcc11.patch?expand=0"))),(0,r.kt)("h2",{id:"noqemu"},"noqemu"),(0,r.kt)("p",null,"\u80fd patch \u4f7f\u7528 generic \u5206\u652f\u7684\u5c31\u4e0d\u8981 noqemu\uff0c\u5982\u679c qemu \u8fc7\u4e0d\u4e86\u677f\u5b50\u80fd\u8fc7\uff0c\u4e0d\u8981\u4fee\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e3a\u4ec0\u4e48\u6211\u4eec\u4e0d\u5c1d\u8bd5\u5bf9 qemu user \u8fdb\u884c\u4fee\u590d\u5462\uff1f")),(0,r.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u9047\u5230\u597d\u51e0\u4e2a qemu \u6302\u6b7b\u7684\u7248\u672c\uff0c\u6211\u4eec\u7ef4\u62a4\u4e86\u597d\u51e0\u4e2a\u7248\u672c"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u9996\u5148\u662f\u8fd9\u4e2a always-malloc\uff0c\u6211\u4eec\u624b\u6253\u4e86\u4e2a glib\uff0c\n\u7a0d\u5fae\u7f13\u89e3\u4e86\u4e00\u4e9b ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/ZenithalHourlyRate/glib"},"https://github.com/ZenithalHourlyRate/glib")),(0,r.kt)("li",{parentName:"ol"},"\u7136\u540e qemu \u5728 futex pi \u8fd9\u4e2a syscall \u4e0a\u7ffb\u8bd1\u4e0d\u884c\uff0c\n\u8fd9\u5728\u67d0\u4e9b glibc \u7248\u672c\u4e0b\u4f1a\u5bfc\u81f4 pthread \u6302\uff08\u5f71\u54cd\u6240\u6709 qemu-user \u7248\u672c\uff0c\u4e0d\u53ea riscv\uff09\uff0c\n\u7136\u540e\u7c97\u7cd9\u6413\u4e86\u4e00\u4e2a ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/ZenithalHourlyRate/qemu"},"https://github.com/ZenithalHourlyRate/qemu")),(0,r.kt)("li",{parentName:"ol"},"\u6211\u4eec\u8fd8\u53d1\u73b0\u4e00\u4e9b\u60c5\u51b5\u4e0b\u8fdb\u7a0b\u4f1a Z \u6389\uff08\u6253 rust \u7684\u65f6\u5019\uff09\uff0c\u6211\u4eec\u731c\u6d4b\u548c\u8fd9\u4e2a\nissue \u6709\u5173 ",(0,r.kt)("a",{parentName:"li",href:"https://gitlab.com/qemu-project/qemu/-/issues/140"},"https://gitlab.com/qemu-project/qemu/-/issues/140")," \uff0c\n\u4f46\u770b\u8d77\u6765\u975e\u5e38 non-trivial \u4e0d\u597d\u4fee\uff0c\u79f0\u5176\u4e3a vfork \u5427"),(0,r.kt)("li",{parentName:"ol"},"\u5728 always-malloc \u4fee\u4e86\u4ee5\u540e\uff0c\u6211\u4eec\u4f9d\u7136\u4f1a\u9047\u5230\u548c 1 \u4e00\u6837\u7684 futex hang\n\u7684\u95ee\u9898\uff08\u6253 go \u7684\u65f6\u5019\uff09\uff0c\u6211\u4eec\u8fd8\u6ca1\u8c03\u67e5\u548b\u56de\u4e8b")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e3a\u4ec0\u4e48\u8981\u9009\u62e9\u624b\u52a8\u7ef4\u62a4 noqemu blacklist \u8fd9\u79cd\u770b\u4f3c\u4f4e\u6548\u7684\u65b9\u5f0f\u5462\uff1f")),(0,r.kt)("p",null,"\u6839\u636e\u6d4b\u8bd5\uff0cQEMU-User \u7f16\u8bd1\u901f\u5ea6\u5927\u4e8e RISC-V \u677f\u5b50\u5927\u4e8e QEMU-System\uff0c\n\u624b\u5de5\u7ef4\u62a4 noqemu blacklist \u5176\u5b9e\u6548\u7387\u53cd\u800c\u66f4\u9ad8\u4e00\u4e9b\u3002"),(0,r.kt)("h2",{id:"rust"},"Rust"),(0,r.kt)("p",null,"\u53c2\u8003 ",(0,r.kt)("a",{parentName:"p",href:"./rust-related"},(0,r.kt)("em",{parentName:"a"},"Rust \u76f8\u5173\u7684\u4e00\u4e9b\u8bb0\u5f55"))),(0,r.kt)("h2",{id:"sse-related-issue"},"SSE Related issue"),(0,r.kt)("p",null,(0,r.kt)("del",{parentName:"p"},"\u653e\u5230 riscv \u677f\u5b50\u4e0a\u8dd1\uff0c\u7136\u540e\u6807 noqemu")),(0,r.kt)("p",null,"\u73b0\u5728\u53ef\u4ee5\u7528 simde2 \u6765\u6a21\u62df SSE2 \u5b9e\u73b0\uff0c\u4ee5\u63d0\u4f9b SSE2 \u652f\u6301\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a PR\uff1a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/felixonmars/archriscv-packages/pull/3011/files"},"#3011"),"\u3002"),(0,r.kt)("h2",{id:"go"},"Go"),(0,r.kt)("h3",{id:"patch-go-dep"},"Patch ",(0,r.kt)("inlineCode",{parentName:"h3"},"go dep")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=console",title:"console"},"go mod edit -replace github.com/prometheus/client_golang=github.com/prometheus/client_golang@efe7aa7\ngo mod download github.com/prometheus/client_golang\n\n# \u8fd9\u4e2a\u662f\u6839\u636e\u4e0d\u52a0 go get \u7684\u62a5\u9519\u63d0\u793a\u6765\u6dfb\u52a0\u7684\n# \u6ca1\u62a5\u9519\u53ef\u4ee5\u4e0d\u7528\u52a0\uff0c\u6ce8\u610f\u8981\u53bb\u6389\u7248\u672c\u53f7\uff08@ \u540e\u9762\u7684\u90e8\u5206\uff09\ngo get github.com/prometheus/client_golang/prometheus\n\ngo generate  # if necessary\ncd cmd/traefik\ngo build\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5177\u4f53\u53c2\u8003\uff1a\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/felixonmars/archriscv-packages/pull/346/files"},"https://github.com/felixonmars/archriscv-packages/pull/346/files"))),(0,r.kt)("h3",{id:"\u7ed9-go-\u5305\u7684\u4f9d\u8d56\u7684\u4f9d\u8d56\u6253patch\u7684\u6b63\u786e\u65b9\u5f0f"},"\u7ed9 go \u5305\u7684\u4f9d\u8d56\uff08\u7684\u4f9d\u8d56\uff09\u6253patch\u7684\u6b63\u786e\u65b9\u5f0f"),(0,r.kt)("p",null,"Go \u6bd4\u8f83\u7279\u6b8a\uff0cGo \u662f\u5728 build \u7684\u65f6\u5019 install\u3002\n\u5047\u8bbe\u6709\u4e00\u7cfb\u5217\u7684\u4f9d\u8d56\u94fe\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"a->b->c->d->e"),"\u3002\n\u5982\u679c\u9700\u8981\u4fee d\uff0c\u5219 bcd \u90fd\u9700\u8981 fork\uff0c\u4fee\u597d d \u4e4b\u540e bc \u6539\u4f9d\u8d56\u3002"),(0,r.kt)("p",null,"Go \u8fd8\u53ef\u4ee5\u5728 go.mod \u91cc\u7528 replace \u8bed\u6cd5\u6765\u66ff\u6362\u4f9d\u8d56\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text",metastring:"title=go.mod",title:"go.mod"},"replace github.com/creack/goselect => github.com/creack/goselect v0.1.2\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5177\u4f53\u53c2\u8003\uff1a\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/felixonmars/archriscv-packages/pull/387/commits/ad0e66c31b21efd93fff93be8cce5b9e13b59953"},"https://github.com/felixonmars/archriscv-packages/pull/387/commits/ad0e66c31b21efd93fff93be8cce5b9e13b59953"))),(0,r.kt)("h3",{id:"\u7f16\u8bd1-golang-\u5305\u7684\u65f6\u5019\u7ecf\u5e38\u5361\u6b7b"},"\u7f16\u8bd1 golang \u5305\u7684\u65f6\u5019\u7ecf\u5e38\u5361\u6b7b"),(0,r.kt)("p",null,"QEMU \u7684\u9505\uff0c\u76f4\u63a5\u6740\u6389\u91cd\u65b0\u5f00\u59cb\u3002"),(0,r.kt)("h3",{id:"bad-pointer"},"bad pointer"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"runtime: bad pointer in frame ... at 0x...\nfatal error: invalid pointer found on stack\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u8ddf\u8e2a\u4e00\u4e0b\u8fd9\u4e2a issue: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/golang/go/issues/51101"},"https://github.com/golang/go/issues/51101")),(0,r.kt)("p",null,"\u4ee5\u540e go build \u7684\u65f6\u5019\u52a0\u4e0a\u8fd9\u4e2a flag ",(0,r.kt)("inlineCode",{parentName:"p"},'-gcflags=all="-N -l"'),"\uff0c\u5e76\u4e14\u5f80\u4e0a\u9762\u90a3\u4e2a issue \u62a5\u4e00\u4e0b\u3002"),(0,r.kt)("h2",{id:"\u7248\u672c\u53f7"},"\u7248\u672c\u53f7"),(0,r.kt)("p",null,"\u7248\u672c\u53f7\u4e0d\u8981\u8d85\u8fc7\u4e3b\u7ebf\uff0c\u5c3d\u91cf\u4ee5\u50ac\u66f4\u4e3a\u4e3b\u3002\n\u5982\u679c\u5b9e\u5728\u4e0d\u884c\u5c31\u52a0\u4e00\u884c\u6ce8\u91ca\uff0c\u63d0\u4e00\u4e0b\u4e0a\u6e38\u7684\u8fdb\u5ea6\uff0c\u8ba9\u4ee5\u540e\u7ef4\u62a4\u7684\u4eba\u6709\u4e2a\u53c2\u8003\u3002"),(0,r.kt)("h2",{id:"\u5faa\u73af\u4f9d\u8d56"},"\u5faa\u73af\u4f9d\u8d56"),(0,r.kt)("p",null,"\u6709\u4e9b\u5305\u53ef\u4ee5\u4e00\u8d77\u6253\uff0c\u4f46\u5728\u72b6\u6001\u9875\u4e0a\u663e\u793a\u4e92\u76f8\u7f3a\u4e86\u5bf9\u65b9\uff0c\u8fd9\u79cd\u9700\u8981 bootstrap\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8be6\u7ec6\u53c2\u8003 ghc bootstrap Patch:\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/felixonmars/archriscv-packages/pull/17/commits/36279fff5314fbcd212549ede73db5257ef10b1d"},"https://github.com/felixonmars/archriscv-packages/pull/17/commits/36279fff5314fbcd212549ede73db5257ef10b1d"))),(0,r.kt)("h2",{id:"intel-related"},"Intel related"),(0,r.kt)("p",null,"Intel \u7684\u4e00\u4e9b\u5305\uff0c\u6ca1\u7559 Generic \u5b9e\u73b0\uff0c\u53ea\u6709 x86 simd \u7684\uff0c\u6bd4\u5982 hyperscan\uff0c\n\u8fd9\u79cd\u5305\u5c31\u76f4\u63a5\u8df3\u8fc7\u4e0d\u7ba1\u4e86\u3002"),(0,r.kt)("h2",{id:"qmake"},"Qmake"),(0,r.kt)("p",null,"\u4f7f\u7528 qmake \u6784\u5efa\u7684\u5305\u6784\u5efa\u65f6\u63d0\u793a ",(0,r.kt)("inlineCode",{parentName:"p"},"Could not find qmake spec 'default'.")),(0,r.kt)("p",null,"\u8fd9\u79cd\u60c5\u51b5\u76ee\u524d\u9700\u8981\u53bb\u677f\u5b50\u4e0a\u6253\u5305\u3002"),(0,r.kt)("h2",{id:"xx-is-not-available-for-the-riscv64-architecture"},"XX is not available for the 'riscv64' architecture"),(0,r.kt)("p",null,"\u8fd9\u662f\u56e0\u4e3a PKGBUILD \u7684 arch \u6570\u7ec4\u8bbe\u7f6e riscv64 \u7684\u503c\u3002\n\u8bf7\u4e0d\u8981\u628a arch \u6539\u4e3a any\uff0cany \u8868\u793a\u4e0d\u540c\u67b6\u6784\u51fa\u7684\u5305\u4e8c\u8fdb\u5236\u4e0a\u6ca1\u6709\u533a\u522b\u3002"),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u7528 setconf \u91cd\u65b0\u8bbe\u7f6e\u503c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console",metastring:"title=console",title:"console"},"setconf PKGBUILD arch '(riscv64 x86_64)'\n")),(0,r.kt)("p",null,"\u8fd8\u6709\u8bf7\u6ce8\u610f\n",(0,r.kt)("a",{parentName:"p",href:"../guide/PR-guide#%E4%B8%8D%E8%A6%81%E6%8F%90%E4%BA%A4-archany"},"\u4e0d\u8981\u63d0\u4ea4\u4fee\u6539\u540e\u7684 arch")),(0,r.kt)("h2",{id:"msse"},"msse"),(0,r.kt)("p",null,"Error: ",(0,r.kt)("inlineCode",{parentName:"p"},"c++: error: unrecognized command-line option '-msse'")),(0,r.kt)("p",null,"\u8fd9\u662f\u56e0\u4e3a -msse \u8fd9\u4e2a\u7f16\u8bd1\u9009\u9879\u6682\u65f6\u8fd8\u4e0d\u652f\u6301 ",(0,r.kt)("inlineCode",{parentName:"p"},"x86_64")," \u4ee5\u5916\u7684 Arch\uff0c\n\u4f60\u9700\u8981\u67e5\u770b\u4e00\u4e0b\u8fd9\u4e2a\u9879\u76ee\u7684 CMakeList \u9009\u9879\uff0c\u6682\u65f6\u628a\u4ed6\u5173\u95ed\u3002"),(0,r.kt)("p",null,"\u6bd4\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"cmake -DSSE=OFF"),"\u3002"),(0,r.kt)("h2",{id:"unknown-public-key"},"Unknown public key...."),(0,r.kt)("p",null,"\u8fd9\u662f\u56e0\u4e3a\u672c\u5730\u7684 gpg \u6570\u636e\u5e93\u6ca1\u6709\u8fd9\u4e2a\u5f00\u53d1\u8005\u7684\u516c\u94a5\u3002\u4f60\u53ef\u4ee5\u7528\u547d\u4ee4\n",(0,r.kt)("inlineCode",{parentName:"p"},"gpg --recv-key keyid")," \u4e0b\u8f7d\u5e76\u5bfc\u5165\u8fd9\u4e2a key\u3002"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\u5982\u679c\u9047\u5230\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"gpg: keyserver receive failed: No data")," \u8fd9\u6837\u7684\u9519\u8bef\uff0c\n\u5927\u6982\u7387\u662f keyserver \u88ab\u6a44\u6984\u4e86\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"sks pool \u56e0\u4e3a\u662f\u5355\u589e\u7684\uff0c\u65e0\u6cd5\u6ee1\u8db3 GDPR \u5bf9\u88ab\u9057\u5fd8\u6743\u7684\u89c4\u5b9a\uff0c\n\u88ab\u6b27\u76df\u6cd5\u5f8b\u6a44\u6984\u4e86\u3002")),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u5148\u5c1d\u8bd5\u5728\u4e0b\u9762\u51e0\u4e2a sks \u955c\u50cf\u770b\u770b\u80fd\u4e0d\u80fd\u627e\u5230\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://pgp.surfnet.nl/\npgp.uni-mainz.de 11370\npgp.circl.lu 11370\nkeys.andreas-puls.de 11370\n")),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"gpg --keyserver https://example.com --recv-key keyid")," \u6765\u6307\u5b9a\u4e0b\u8f7d\u670d\u52a1\u5668\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u8fd8\u662f\u627e\u4e0d\u5230\uff0c\u53ef\u4ee5\u627e\u627e\u4ed6\u4eec\u9879\u76ee\u4e3b\u9875\uff0c\u56e2\u961f\u4ecb\u7ecd\uff0c\u4e2a\u4eba\u535a\u5ba2\u7b49\u7b49\u7b49\u9875\u9762\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u662f GitHub \u7684\u9879\u76ee\uff0c\u4f60\u53ef\u4ee5\u627e\u5230\u90a3\u4e2a\u5f00\u53d1\u8005\u7684\u4e3b\u9875\uff0c\u7136\u540e\u5728\u540e\u9762\u52a0\u4e0a ",(0,r.kt)("inlineCode",{parentName:"p"},".gpg")," \u6765\u67e5\u770b\u4ed6\u7684 key\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"https://github.com/user.gpg\n                       ^^^^\n")),(0,r.kt)("p",null,"\u7136\u540e\u7528 gpg import \u5bfc\u5165\uff1a ",(0,r.kt)("inlineCode",{parentName:"p"},"curl https://github.com/user.gpg | gpg --import")),(0,r.kt)("p",null,"Arch Linux \u6700\u8fd1\u901a\u8fc7\u4e86\u628a key \u653e\u5230 SVN \u7684 RFC\uff0c\u7b49 Arch \u4e5f\u6709 key \u4e86\u6211\u4eec\u5c31\u53ef\u4ee5\u5220\u6389\u4e86\u3002\n\u5982\u679c\u627e\u4e0d\u5230 key \u5c31\u5230\u4e0a\u6e38\u5f00 bug report \u8ba9\u4ed6\u4eec\u628a key \u653e\u5230 svn\u3002\n\u5982\u679c\u4f60\u627e\u5230\u4e86 key\uff0c\u53ef\u4ee5\u5148\u628a key \u548c riscv64.patch \u653e\u4e00\u8d77\u63d0\u4ea4\u5230\u80a5\u732b\u4ed3\u5e93\u3002"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\u5982\u679c\u5b9e\u5728\u662f\u627e\u4e0d\u5230 key\uff0c\u4f46\u662f\u53c8\u6025\u7740\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u7528\u53c2\u6570 ",(0,r.kt)("inlineCode",{parentName:"p"},"--skippgpcheck")," \u6682\u65f6\u8df3\u8fc7\u68c0\u67e5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'extra-riscv64-build -- -d "..." -- --skippgpcheck\n                                 # ^^^^^^^^^^^^^^^^^ \u591a\u7528\u4e00\u4e2a -- \u628a skippgpcheck \u4f20\u7ed9\u66f4\u4e0b\u5c42\u7684 makepkg\n')),(0,r.kt)("p",null,"\u6216\u8005\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\uff1a\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/archlinuxcn/lilac/blob/master/recv_gpg_keys"},"https://github.com/archlinuxcn/lilac/blob/master/recv_gpg_keys")),(0,r.kt)("h2",{id:"electron"},"Electron"),(0,r.kt)("p",null,"v8 \u7248\u672c\u4f4e\u4e8e 9.0 \u7684\u5c31\u4e0d\u7528\u4fee\u4e86\uff0c\u4ece 9.0 \u5f00\u59cb\u6709\u5b9e\u9a8c\u6027\u7684 risc-v \u652f\u6301\u3002"),(0,r.kt)("h2",{id:"node-sass"},"node-sass"),(0,r.kt)("p",null,"node-sass v6 \u5c31\u662f\u4e0d\u652f\u6301 node v17 \u7684\uff0cnode-sass \u5bf9 njs v17 \u7684\u652f\u6301\u59cb\u4e8e\u7248\u672c 7.0.0\uff0c\n6.x \u652f\u6301\u7684 njs version\uff1a12, 14, 15, 16\uff0c\u6240\u4ee5\u8981\u4e48\u5c31\u628a dependency \u4ece nodejs \u6539\u6210 nodejs-lts-gallium\uff0c\n\u8981\u4e48\u5c31\u50ac\u4e0a\u6e38\u66f4\u65b0 package.json \u91cc node-sass \u7684\u7248\u672c\uff0cwhich is nonsense\uff0c\u56e0\u4e3a\u5927\u7248\u672c\u53f7\u7684\u66f4\u65b0\u5f80\u5f80\u5e26\u6765\u4e0d\u517c\u5bb9\u3002"),(0,r.kt)("h2",{id:"\u5173\u4e8e-upstream"},"\u5173\u4e8e upstream"),(0,r.kt)("p",null,"\u5982\u679c\u4e0a\u6e38\u7684 maintainer \u662f\u80a5\u732b\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u7fa4\u91cc @ \u80a5\u732b\u3002"),(0,r.kt)("h2",{id:"python-2to3"},"Python 2to3"),(0,r.kt)("p",null,"Python \u7684\u5305\u4e0d\u7ba1 major version \u90fd\u8981\u8dd1\u4e00\u6b21 2to3\u3002"),(0,r.kt)("h2",{id:"\u6d4b\u8bd5"},"\u6d4b\u8bd5"),(0,r.kt)("p",null,"\u5982\u679c\u6709\u7684\u5305\u4e0d\u5728\u4e4e\u6d4b\u8bd5\u662f\u5426\u901a\u8fc7\uff0c\u6bd4\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"test || echo"),"\uff0c\u90a3\u5c31\u76f4\u63a5\u628a\u6d4b\u8bd5\u6ce8\u91ca\u6389\u3002"),(0,r.kt)("h2",{id:"\u8bbf\u95ee\u4e00\u4e9b\u4f1a\u5728\u7f16\u8bd1\u671f\u88ab\u5220\u9664\u7684\u6587\u4ef6"},"\u8bbf\u95ee\u4e00\u4e9b\u4f1a\u5728\u7f16\u8bd1\u671f\u88ab\u5220\u9664\u7684\u6587\u4ef6"),(0,r.kt)("p",null,"\u6709\u4e00\u4e2a\u6bd4\u8f83\u810f\u7684\u505a\u6cd5\uff1a\u5f80 PKGBUILD \u91cc\u585e\u4e00\u4e2a bash\uff0c\u7136\u540e\u5c31\u7528\u8fd9\u4e2a subshell \u6765\u4ea4\u4e92\u3002"),(0,r.kt)("h2",{id:"gcc-nostdlib"},"gcc nostdlib"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"-nostdlib")," \u4f1a\u8986\u76d6 ",(0,r.kt)("inlineCode",{parentName:"p"},"-pthread")),(0,r.kt)("h2",{id:"glibc-optimization"},"glibc optimization"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"error: glibc cannot be compiled without optimization\n")),(0,r.kt)("p",null,"solution: \u52a0\u4e0a ",(0,r.kt)("inlineCode",{parentName:"p"},"-O1")),(0,r.kt)("h2",{id:"patch-hunk-offset"},"patch hunk offset"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Q:")," \u5e73\u65f6\u66f4\u65b0 patch \u7684\u65f6\u5019\uff0c\u5982\u679c\u6709\u4ee3\u7801\u7684 patch hunk \u98d8\u4e86\uff0c\u80fd\u6253\u4e0a\u4f46\u662f\u6709 offset\uff0c\u9700\u8981\n\u628a patch \u66f4\u65b0\u6210\u6700\u65b0\u7684\u884c\u53f7\u5417\uff1f"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"A:")," \u4e0d\u9700\u8981"),(0,r.kt)("h2",{id:"unguarded-availability-new"},"unguarded-availability-new"),(0,r.kt)("p",null,"Error:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"cc1plus: error: \u2018-Werror=unguarded-availability-new\u2019: no option \u2018-Wunguarded-availability-new\u2019\n")),(0,r.kt)("p",null,"\u8fd9\u4e2a\u9009\u9879\u53ea\u6709 clang \u624d\u6709\uff0c\u5982\u679c\u6ca1\u6709\u5f3a\u5236\u4f7f\u7528 GNU \u7684\u6784\u5efa\u5de5\u5177\uff0c\n\u53ef\u4ee5\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf ",(0,r.kt)("inlineCode",{parentName:"p"},"CC=clang CXX=clang++")," \u5f3a\u5236\u4f7f\u7528 clang \u6765\u7f16\u8bd1\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u8fd9\u4e2a\u9879\u76ee\u7528\u7684 cmake\uff0c\u53ef\u4ee5\u52a0\u4e24\u4e2a\u53c2\u6570\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'"-DCMAKE_C_COMPILER=clang"\n"-DCMAKE_CXX_COMPILER=clang++"\n')),(0,r.kt)("p",null,"\u540c\u65f6\u8bb0\u5f97\u7ed9\u4e0a\u6e38\u62a5 BUG \u8ba9\u4ed6\u4eec\u9ed8\u8ba4\u4f7f\u7528 clang \u6765\u7f16\u8bd1\u3002"),(0,r.kt)("h2",{id:"tarball-url-\u53d8\u4e86\u8be5\u600e\u4e48\u529e"},"tarball URL \u53d8\u4e86\u8be5\u600e\u4e48\u529e"),(0,r.kt)("p",null,"\u7ed9 Arch \u4ea4 BUG"),(0,r.kt)("h2",{id:"\u5728-qemu-\u5185\u6784\u5efa\u5931\u8d25\u4f46\u5728\u677f\u5b50\u4e0a\u6784\u5efa\u6210\u529f\u600e\u4e48\u5904\u7406"},"\u5728 QEMU \u5185\u6784\u5efa\u5931\u8d25\u4f46\u5728\u677f\u5b50\u4e0a\u6784\u5efa\u6210\u529f\u600e\u4e48\u5904\u7406"),(0,r.kt)("p",null,"\u6807\u8bb0\u8fd9\u4e2a\u5305\u4e3a noqemu\uff0c\u540c\u65f6\u5f80 repo \u91cc\u7684 qemu-user-blacklist.txt \u91cc\u52a0\u5165\u8fd9\u4e2a\u5305\u3002"),(0,r.kt)("p",null,"Ref: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/felixonmars/archriscv-packages/blob/master/qemu-user-blacklist.txt"},"https://github.com/felixonmars/archriscv-packages/blob/master/qemu-user-blacklist.txt")),(0,r.kt)("h2",{id:"invalid-or-corrupted-package-pgp-signature"},"invalid or corrupted package (pgp signature)"),(0,r.kt)("p",null,"\u5982\u679c\u5728\u6784\u5efa any \u5305\u7684\u65f6\u5019\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u7f13\u5b58\u51b2\u7a81\u95ee\u9898\u3002\nx86_64 \u548c riscv64 \u4e0b\u7684 any \u5305\u7684\u540d\u5b57\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u7684\u7b7e\u540d\u4e0d\u540c\u3002\n\u5982\u679c\u6709\u4eba\u6784\u5efa\u5305\u7684\u65f6\u5019\u6ca1\u5efa\u7f13\u5b58\u76ee\u5f55\uff0c\u5b8c\u4e8b\u513f\u4e86\u4e5f\u6ca1\u5220\u6389\uff0c\n\u5f53\u6784\u5efa\u7684\u65f6\u5019\u7528\u5230\u4e86\u522b\u4eba\u7684\u7f13\u5b58\u5c31\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u3002"),(0,r.kt)("p",null,"\u89e3\u51b3\u65b9\u6848\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u81ea\u5efa cache \u76ee\u5f55"),(0,r.kt)("li",{parentName:"ul"},"\u5220\u4e86\u7f13\u5b58\u91cd\u65b0\u8dd1\u6784\u5efa")),(0,r.kt)("h2",{id:"\u78c1\u76d8\u5360\u7528\u6ee1\u4e86"},"\u78c1\u76d8\u5360\u7528\u6ee1\u4e86"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"lto: fatal error: write: No space left on device")),(0,r.kt)("p",null,"\u5f88\u6709\u53ef\u80fd\u4e0d\u662f\u771f\u7684\u5403\u6ee1\u4e86\uff0c\u662f\u56e0\u4e3a devtools \u4f7f\u7528\u4e86 systemd-nspawn\uff0c\u800c\u540e\u8005\u9ed8\u8ba4\u7528\u53c2\u6570 ",(0,r.kt)("inlineCode",{parentName:"p"},"size=10%"),"\n\u6302\u8f7d\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"/tmp")," \u76ee\u5f55\u4e0a\u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u5c1d\u8bd5\u8c03\u6574 ",(0,r.kt)("inlineCode",{parentName:"p"},"SYSTEMD_NSPAWN_TMPFS_TMP")," \u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\u6765\u62d2\u7edd\u6302\u8f7d tmpfs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"SYSTEMD_NSPAWN_TMPFS_TMP=0 extra-x86_64-build\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8bb0\u5f97\u9700\u8981\u52a0\u4e0a sudo \u7528 root \u8dd1\uff0c\u4e0d\u7136 devtools \u81ea\u5df1 sudo \u4e86\u4e4b\u540e\uff0c\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\u5c31\u6ca1\u4e86\u3002")),(0,r.kt)("h2",{id:"\u5927\u91cf\u4f9d\u8d56\u7f3a\u5931"},"\u5927\u91cf\u4f9d\u8d56\u7f3a\u5931"),(0,r.kt)("p",null,"\u4e0d\u4e00\u5b9a\u662f\u6240\u6709\u4f9d\u8d56\u90fd\u4e0d\u5339\u914d\uff0cpacman \u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"depends=(a, b, c, d, e)"),"\uff0c\n\u7136\u540e\u5982\u679c e \u7f3a\u4e86\u5b83\u4f1a\u8bf4 ",(0,r.kt)("inlineCode",{parentName:"p"},"a b c d e not found"),"\u3002"),(0,r.kt)("h2",{id:"configguess"},"config.guess"),(0,r.kt)("p",null,"\u5982\u679c\u9047\u5230"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"config.guess fail to detect system type\n")),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"autoreconf -fi")," \u66f4\u65b0\u9644\u5e26\u6587\u4ef6\uff0c\u540c\u65f6\u5411\u4e0a\u6e38\u62a5\u544a\u5b83\u4eec\u7684\u6587\u4ef6\u9700\u8981\u66f4\u65b0\u3002\n\u5982\u679c\u56e0\u4e3a\u7248\u672c\u8fc7\u8001\u4f7f\u7528\u547d\u4ee4\u5931\u8d25\u7684\uff0c\u62f7\u8d1d\n",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/share/autoconf/build-aux/config.guess")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"config.sub")," \u6587\u4ef6\uff0c\u5e76\u5411\u4e0a\u6e38\u62a5\u544a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"\u8bf7\u4e00\u5b9a\u8981\u5411\u4e0a\u6e38\u62a5\u544a\uff01")),(0,r.kt)("p",{parentName:"blockquote"},"config.sub \u4e0a\u6e38\u6709\u804c\u8d23\u53ca\u65f6\u66f4\u65b0\u3002")),(0,r.kt)("h2",{id:"nodejs-\u7684\u67d0\u4e9b\u5305\u51fa\u73b0\u602a\u5f02\u7684\u9519\u8bef"},"nodejs \u7684\u67d0\u4e9b\u5305\u51fa\u73b0\u602a\u5f02\u7684\u9519\u8bef"),(0,r.kt)("p",null,"\u6bd4\u5982, babel \u6253\u5370\u4e00\u884c\u4e0d\u660e\u6240\u4ee5\u7684\u62a5\u9519\u7136\u540e\u9000\u51fa."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"{ valid: true, value: null }\n")),(0,r.kt)("p",null,"\u8fd9\u662f\u56e0\u4e3a\u76ee\u524d riscv64 \u4e0a\u7684 V8 \u7684 JIT \u6709 Bug."),(0,r.kt)("p",null,"\u53ef\u4ee5\u5c1d\u8bd5\u4e0b\u9762\u4e24\u79cd\u65b9\u6cd5"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf ",(0,r.kt)("inlineCode",{parentName:"li"},"NODE_OPTIONS='--jitless'")," \u6216\u8005\u7ed9 node \u4f20 ",(0,r.kt)("inlineCode",{parentName:"li"},"--jitless"),". \u4f46\u662f\u8fd9\u4f1a\u4e00\u5e76\u7981\u7528 WebAssembly. \u597d\u5904\u662f\u7528\u73af\u5883\u53d8\u91cf\u4f20\u9012\u4e0d\u7528 patch \u4ee3\u7801"),(0,r.kt)("li",{parentName:"ul"},"\u7ed9 Node \u52a0\u4e0a ",(0,r.kt)("inlineCode",{parentName:"li"},"--max-opt=0")," \u53c2\u6570. \u8fd9\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a V8 \u7684\u53c2\u6570. \u8fd9\u4e2a\u53c2\u6570\u4e0d\u80fd\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u4f20\u9012, \u9700\u8981 patch \u4ee3\u7801, \u4f46\u662f\u4e0d\u4f1a\u7981\u7528 WebAssembly.")))}d.isMDXComponent=!0}}]);